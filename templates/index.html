<!DOCTYPE HTML>
<html>

<head>
	<title>Flask-SocketIO Test</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"
		integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ=="
		crossorigin="anonymous"></script>
	<script type="text/javascript" charset="utf-8">
		document.addEventListener('DOMContentLoaded', function () {
			// Connect to the Socket.IO server.
			// The connection URL has the following format, relative to the current page:
			//     http[s]://<domain>:<port>[/<namespace>]
			var socket = io();

			// Event handler for server sent data.
			// The callback function is invoked whenever the server emits data
			// to the client. The data is then displayed in the "Received"
			// section of the page.
			socket.on('my_response', function (msg, cb) {
				console.log(msg.text, msg.values[4]);
				const fillPercentage = Math.round(Math.min(100, msg.values[4] * 100));
				let meter = document.getElementById('meter');

				if (fillPercentage > 50) {
					meter.style.background = "#f00"
					meter.style.filter = "drop-shadow(0 0 2.5px #f00) drop-shadow(0 0 10px #f00)"
				} else {
					meter.style.background = "#ff0"
					meter.style.filter = "drop-shadow(0 0 2.5px #ff0) drop-shadow(0 0 10px #ff0)"

				}
				meter.style.height = fillPercentage + '%';
				myChart.style.background = `linear-gradient(to top, red ${fillPercentage}%, transparent ${fillPercentage}%)`;
				if (cb)
					cb();
			});
		});
	</script>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			display: flex;
			justify-content: center;
			align-items: center;
			min-height: 100vh;
			background: #00ff00;
		}

		.box {
			position: absolute;
			width: 100vw;
			height: 100vh;
			display: flex;
			justify-content: center;
			align-items: center;
			background: #333;
			box-shadow: 0 5px 50px rgba(0, 0, 0, 0.5);
			border-radius: 20px;
		}

		.spinner {
			position: relative;
			width: calc(100vw - 20px);
			gap: 12px;
			display: flex;
			justify-content: center;
			align-items: center;
			flex-direction: column;
			user-select: none;
		}

		.progress {
			position: relative;
			width: 100%;
			background: #222;
			height: calc(100vh - 20px);
			display: flex;
			flex-direction: column-reverse;
			border-radius: 20px;
		}

		.progress #meter {
			position: absolute;
			width: 100%;
			background: #ff0;
			filter: drop-shadow(0 0 2.5px #ff0) drop-shadow(0 0 10px #ff0);
			transition: 0.5s;
			border-radius: 20px;
		}

		#output {
			position: relative;
			color: #fff;
			font-size: 2em;
			text-shadow: 0 0 5px #fff;
			display: none;
		}
	</style>
</head>

<body>
	<div class="box">
		<div class="spinner">
			<span id="output"></span>
			<div class="progress">
				<span id="meter"></span>
			</div>
		</div>
	</div>
</body>

</html>