<!DOCTYPE HTML>
<html>

<head>
	<title>Flask-SocketIO Test</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Reggae+One&display=swap" rel="stylesheet">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"
		integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ=="
		crossorigin="anonymous"></script>
	<script type="text/javascript" charset="utf-8">
		document.addEventListener('DOMContentLoaded', function () {
			// Connect to the Socket.IO server.
			// The connection URL has the following format, relative to the current page:
			//     http[s]://<domain>:<port>[/<namespace>]
			var socket = io();

			// Event handler for server sent data.
			// The callback function is invoked whenever the server emits data
			// to the client. The data is then displayed in the "Received"
			// section of the page.
			socket.on('my_response', function (msg, cb) {
				console.log(msg.text, msg.values[4]);

				const fillPercentage = Math.round(Math.min(100, msg.values[4] * 100));
				let oko = document.getElementById('oko');
				let daipan = document.getElementById('daipan');

				const fill = document.getElementById("fill");
				fill.style.setProperty('--percent', `${100 - fillPercentage}%`);
				const fillBlur = document.getElementById("fill-blur");
				fillBlur.style.setProperty('--percent', `${100 - fillPercentage}%`);

				if (fillPercentage > 50) {
					daipan.style.opacity = 1.0;
					oko.style.opacity = 0.0;
				} else if (fillPercentage > 0) {
					oko.style.opacity = 1.0;
					daipan.style.opacity = 0.0;
				} else {
					oko.style.opacity = 0.0;
					daipan.style.opacity = 0.0;
				}

				if (cb)
					cb();
			});
		});
	</script>
	<style>
		:root {
			--percent: 100%;
		}

		.common {
			position: absolute;
			width: calc(100vw - 10vw);
			height: calc(100vh - 100vw - 10vw - 10vh);
			bottom: calc(100vw + 5vw + 5vh);
			left: 5vw;
		}

		#border {
			background: #666;
			border: 5vw solid white;
			transform: skew(0deg, 20deg);
		}

		#fill {
			transition: 0.5s;
			transform: skew(0deg, 20deg);
			width: calc(100vw - 10vw - 10vw);
			height: calc(100vh - 100vw - 10vw - 10vh - 10vw);
			left: 10vw;
			bottom: calc(100vw + 5vw + 5vh + 5vw);
			background: linear-gradient(to top, yellow, red);
			clip-path: inset(var(--percent) 0 0 0);
		}

		#fill-blur {
			filter: blur(12vw);
		}

		#fill-blur::before {
			transition: 0.5s;
			transform: skew(0deg, 20deg);
			content: '';
			position: absolute;
			width: calc(100vw - 10vw - 10vw);
			height: calc(100vh - 100vw - 10vw - 10vh - 10vw);
			left: 5vw;
			bottom: 5vw;
			clip-path: inset(var(--percent) 0 0 0);
			background: linear-gradient(to top, yellow, red);
			filter: brightness(1.5);
			opacity: 0.7;
		}

		#text {
			color: white;
			display: flex;
			justify-content: end;
			align-items: center;
			padding-bottom: 30vw;
			font-size: calc(100vw - 10vw - 5vw - 30vw);
			font-family: "Reggae One", system-ui;
			writing-mode: vertical-rl;
		}

		body {
			background: black;
		}

		img {
			position: absolute;
			bottom: 5vw;
			left: 5vw;
			width: 90vw;
			height: 90vw;
			transition: 0.5s;
			opacity: 0;
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
	</style>
</head>

<body>
	<img id="daipan" src="{{ url_for('static', filename='images/daipan.gif') }}">
	<img id="oko" src="{{ url_for('static', filename='images/oko.png') }}">
	<div id="border" class="common"></div>
	<div id="fill" class="common"></div>
	<div id="fill-blur" class="common"></div>
	<div id="text" class="common">怒りゲージ</div>
</body>

</html>